<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>8.2.2. The Problem</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - User Guide"/>
      <link rel="up" href="testing1.html" title="8.2. Injecting Mock Objects"/>
      <link rel="prev" href="required.html" title="8.2.1. Required Knowledge"/>
      <link rel="next" href="mock.html" title="8.2.3. Mock Objects"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="required.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="mock.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect2" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="problem"/>8.2.2. The Problem</h3>
               </div>
            </div>
         </div>
         <p>
            The situation is common, we have a Bank application that manages Customers  which can have one or more
            BankAccounts.  The Bank has different business methods to calculate interest, accept loans, etc. (in
            production code this would be large and complex methods.) We want to write tests for the Bank's business
            methods to make sure they work as intended and that we don't introduce bugs if we refactor, extend, modify
            etc. The Bank has three business methods.
         </p>
         <pre class="programlisting">package bank;

import java.util.ArrayList;

import customer.*;

public class BankBusiness {

  private BankAccountDAO bankAccountDAO;

  public BankBusiness() {
    try {
      bankAccountDAO = BankAccountDAOFactory.getBankAccountDAOSerializer();
    }
    catch(Exception e) {
      System.out.println(e.getMessage());
    }
  }

  public boolean creditCheck(Customer c, double amount) {
    return (getSumOfAllAccounts(c) &lt; amount * 0.4);
  }

  public double calculateInterest(BankAccount account) {
    if(account.getBalance() &lt; 1000)
      return 0.01;
    else if(account.getBalance() &lt; 10000)
      return 0.02;
    else if(account.getBalance() &lt; 100000)
      return 0.03;
    else if(account.getBalance() &lt; 1000000)
      return 0.05;
    else
      return 0.06;
  }

  public double getSumOfAllAccounts(Customer c) {
    double sum = 0;
    if(c.getAccounts().size() &lt; 1)
      return sum;
    else {
      for(int i=0; i &lt; c.getAccounts().size(); i++) {
        BankAccount a =
          bankAccountDAO.getBankAccount( ((Long) c.getAccounts().get(i)).longValue());
        if(a != null)
          sum += a.getBalance();
      }
    }
    return sum;
  }

}</pre>
         <p>
            
            <code class="literal">calculateInterest(BankAccount b)</code> can easily be tested since it is only dependent on the
            object it recieves as a parameter.
         </p>
         <p>
            
            <code class="literal">creditCheck(Customer c, double amount)</code> and <code class="literal">getSumOfAllAccounts(Customer)</code>
            are more complicated since they are data dependent. It uses a DAO layer to fetch all BankAccounts for a
            specified customer. The test should not be dependent of the DAO implementation since its goal is to check
            the business logic, not the DAO layer. In this example the DAO implementation is a simple serializer, but it
            could easily be an Entity beans, Hibernate, etc..
         </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="required.html">
               <strong>Prev</strong>8.2.1. Required Knowledge</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="mock.html">
               <strong>Next</strong>8.2.3. Mock Objects</a>
         </li>
      </ul>
   </body>
</html>