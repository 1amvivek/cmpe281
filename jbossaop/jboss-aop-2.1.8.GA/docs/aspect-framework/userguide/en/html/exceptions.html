<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>3.2. Exception Handling</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - User Guide"/>
      <link rel="up" href="building.html" title="Chapter 3. Building Aspects"/>
      <link rel="prev" href="identifying.html" title="3.1. Identifying Aspects"/>
      <link rel="next" href="annotations.html" title="Chapter 4. Aspect-Oriented Annotations"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="identifying.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="annotations.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect1" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="exceptions"/>3.2. Exception Handling</h2>
               </div>
            </div>
         </div>
         <p>
         Metrics and tracing are simple examples of building aspects.  Another great simple example is to use AOP
         for exception handling.  For example, SQLException is an exception that contains error information like invalid
         sql statement or deadlock that is similar per database vendor, but is expressed as different error codes
         and string messages.  You can use AOP to intercept statement execution, catch SQLException errors, and turn
         them into typed exceptions that application code can handle independent of database vendor.  So let's code
         an example of this.
      </p>
         <pre class="programlisting">public class InvalidSQlException extends SQLException
{
   InvalidSQLException(SQLException ex)
   {
       super(ex.getMessage(), ex.getSQLState(), ex.getErrorCode());
   }
}</pre>
         <p>
         What we'll do is write an aspect that wraps calls to all
         <code class="literal">java.sql.Statement</code> execute methods
         and turn them into typed exceptions like the example above.  We'll leave some code up to your imagination
         since such an aspect would be quite long to deal with every error code of every database vendor, but hopefully
         you can get the idea here.
      </p>
         <pre class="programlisting">public class SQLExceptionAspect
{
   public Object handleSqlException(Invocation invocation) throws Throwable
   {
      try
      {
         return invocation.invokeNext();
      }
      catch (SQLException ex)
      {
         if (isVendorInvalidSqlErrorCode(ex.getErrorCode())) throw new InvalidSQLException(ex);
         if (isVendorDeadlockErrorCode(ex.getErrorCode()) throw new SQLDeadlockException(ex);
         ... and so on ...
      }
   }
   ... impl of isVendor methods ...
}</pre>
         <p>
         Now that the aspect is defined we use a
         <code class="literal">call</code> pointcut expression to intercept all the
         execute methods of
         <code class="literal">java.sql.Statement</code>.
      </p>
         <pre class="programlisting">&lt;aspect class="SQLExceptionAspect" scope="PER_VM"/&gt;
&lt;bind pointcut="call(* $instanceof{java.sql.Statement}-&gt;execute*(..))"&gt;
   &lt;advice name="handleSqlException" aspect="SQLExceptionAspect"/&gt;
&lt;/bind&gt;</pre>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="identifying.html">
               <strong>Prev</strong>3.1. Identifying Aspects</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="annotations.html">
               <strong>Next</strong>Chapter 4. Aspect-Oriented Annotations</a>
         </li>
      </ul>
   </body>
</html>