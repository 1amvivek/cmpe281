<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>1.2. Creating Aspects in JBoss AOP</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - User Guide"/>
      <link rel="up" href="what.html" title="Chapter 1. What Is Aspect-Oriented Programming?"/>
      <link rel="prev" href="whatif.html" title="1.1. What is it?"/>
      <link rel="next" href="apply.html" title="1.3. Applying Aspects in JBoss AOP"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="whatif.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="apply.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect1" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="create"/>1.2. Creating Aspects in JBoss AOP</h2>
               </div>
            </div>
         </div>
         <p>
            In short, all AOP frameworks define two things: a way to implement crosscutting concerns, and a
            programmatic construct -- a programming language or a set of tags -- to specify how you want to apply those
            snippets of code.
         </p>
         <p>
            Let's take a look at how JBoss AOP, its cross-cutting concerns, and how you can implement a metrics aspect
            in JBoss.
         </p>
         <p>
            The first step in creating a metrics aspect in JBoss AOP is to encapsulate the metrics feature in its own
            Java class. Listing Two extracts the try/finally block in Listing One's BankAccountDAO.withdraw() method
            into Metrics, an implementation of a JBoss AOP Interceptor class.
         </p>
         <p>Listing Two: Implementing metrics in a JBoss AOP Interceptor</p>
         <pre class="programlisting">01. public class Metrics implements org.jboss.aop.advice.Interceptor
02. {
03.   public Object invoke(Invocation invocation) throws Throwable
04.   {
05.     long startTime = System.currentTimeMillis();
06.     try
07.     {
08.       return invocation.invokeNext();
09.     }
10.     finally
11.     {
12.       long endTime = System.currentTimeMillis() - startTime;
13.       java.lang.reflect.Method m = ((MethodInvocation)invocation).method;
14.       System.out.println("method " + m.toString() + " time: " + endTime + "ms");
15.     }
16.   }
17. }</pre>
         <p>
             Under JBoss AOP, the Metrics class wraps withdraw(): when calling code invokes withdraw(), the AOP
             framework breaks the method call into its parts and encapsulates those parts into an Invocation object.
             The framework then calls any aspects that sit between the calling code and the actual method body.
          </p>
         <p>
             When the AOP framework is done dissecting the method call, it calls Metric's invoke method at line 3.
             Line 8 wraps and delegates to the actual method and uses an enclosing try/finally block to perform the
             timings. Line 13 obtains contextual information about the method call from the Invocation object,
             while line 14 displays the method name and the calculated metrics.
          </p>
         <p>
             Having the metrics code within its own object allows us to easily expand and capture additional
             measurements later on. Now that metrics are encapsulated into an aspect, let's see how to apply it.
          </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="whatif.html">
               <strong>Prev</strong>1.1. What is it?</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="apply.html">
               <strong>Next</strong>1.3. Applying Aspects in JBoss AOP</a>
         </li>
      </ul>
   </body>
</html>