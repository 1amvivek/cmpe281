<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>12.1. Force interception via reflection</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - Aspect-Oriented Framework for Java"/>
      <link rel="up" href="reflection.html" title="Chapter 12. Reflection and AOP"/>
      <link rel="prev" href="reflection.html" title="Chapter 12. Reflection and AOP"/>
      <link rel="next" href="reflection-cleaning.html" title="12.2. Clean results from reflection info methods"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="reflection.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="reflection-cleaning.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect1" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="reflection-attach-chains"/>12.1. Force interception via reflection</h2>
               </div>
            </div>
         </div>
         <p>
         To address the issues with interceptors not being invoked when you use reflection,
         we have provided a reflection aspect. You bind it to a set of caller pointcuts,
         and it mounts the pre-defined interceptor/aspect chains. The jboss-aop.xml entries 
         are:
      </p>
         <p>
         
         </p>
         <pre class="programlisting">
    
   &lt;aspect class="org.jboss.aop.reflection.ReflectionAspect" scope="PER_VM"/&gt;

   &lt;bind pointcut="call(* java.lang.Class-&gt;newInstance())"&gt;
      &lt;advice name="interceptNewInstance" \
         aspect="org.jboss.aop.reflection.ReflectionAspect"/&gt;
   &lt;/bind&gt;

   &lt;bind pointcut="call(* java.lang.reflect.Constructor-&gt;newInstance(java.lang.Object[]))"&gt;
      &lt;advice name="interceptNewInstance" \
         aspect="org.jboss.aop.reflection.ReflectionAspect"/&gt;
   &lt;/bind&gt;

   &lt;bind pointcut="call(* java.lang.reflect.Method-&gt;invoke(java.lang.Object, java.lang.Object[]))"&gt;
      &lt;advice name="interceptMethodInvoke" \
         aspect="org.jboss.aop.reflection.ReflectionAspect"/&gt;
   &lt;/bind&gt;

   &lt;bind pointcut="call(* java.lang.reflect.Field-&gt;get*(..))"&gt;
      &lt;advice name="interceptFieldGet" \
         aspect="org.jboss.aop.reflection.ReflectionAspect"/&gt;
   &lt;/bind&gt;

   &lt;bind pointcut="call(* java.lang.reflect.Field-&gt;set*(..))"&gt;
      &lt;advice name="interceptFieldSet" \
         aspect="org.jboss.aop.reflection.ReflectionAspect"/&gt;
   &lt;/bind&gt;   

         </pre>
         <p>
      
         </p>
         <p>
         The <code class="literal">ReflectionAspect</code> class provides a few hooks for you to override from
         a subclass if you like. These methods described below.
      </p>
         <p>
         
         </p>
         <pre class="programlisting">
   protected Object interceptConstructor(
		Invocation invocation,
		Constructor constructor,
		Object[] args)
		throws Throwable;
         </pre>
         <p>
      
         </p>
         <p>
         Calls to <code class="literal">Class.newInstance()</code> and <code class="literal">Constructor.newInstance()</code>
         end up here. The default behavior is to mount any constructor execution or caller interceptor 
         chains. If you want to override the behaviour, the parameters are:
         </p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <code class="literal">invocation</code> - The invocation driving the chain of advices.</li>
               <li>
                  <code class="literal">constructor</code> - The constructor being called</li>
               <li>
                  <code class="literal">args</code>
               - the arguments being passed in to the constructor (in the case of 
               Class.newInstance(), a zero-length array since it takes no parameters)
            </li>
            </ul>
         </div>
         <p>
      
         </p>
         <p>
         
         </p>
         <pre class="programlisting">
   protected Object interceptFieldRead(
      Invocation invocation,
      Field field,
      Object instance)
      throws Throwable;
         </pre>
         <p>
      
         </p>
         <p>
         Calls to <code class="literal">Field.getXXX()</code> end up here. The default behavior is to mount 
         any field read interceptor chains. If you want to override the behaviour, the parameters are:
         </p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <code class="literal">invocation</code> - The invocation driving the chain of advices.</li>
               <li>
                  <code class="literal">field</code> - The field being read</li>
               <li>
                  <code class="literal">instance</code> - The instance from which we are reading a non-static field.</li>
            </ul>
         </div>
         <p>
      
         </p>
         <p>
         
         </p>
         <pre class="programlisting">
   protected Object interceptFieldWrite(
      Invocation invocation,
      Field field,
      Object instance,
      Object arg)
      throws Throwable;
         </pre>
         <p>
      
         </p>
         <p>
         Calls to <code class="literal">Field.setXXX()</code> end up here. The default behavior is to mount 
         any field write interceptor chains. If you want to override the behaviour, the parameters are:
         </p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <code class="literal">invocation</code> - The invocation driving the chain of advices.</li>
               <li>
                  <code class="literal">field</code> - The field being written</li>
               <li>
                  <code class="literal">instance</code> - The instance on which we are writing a non-static field.</li>
               <li>
                  <code class="literal">arg</code> - The value we are setting the field to
            </li>
            </ul>
         </div>
         <p>
      
         </p>
         <p>
         
         </p>
         <pre class="programlisting">
   protected Object interceptMethod(
		Invocation invocation,
		Method method,
		Object instance,
		Object[] args)
		throws Throwable;
         </pre>
         <p>
      
         </p>
         <p>
         Calls to <code class="literal">Method.invoke()</code> end up here. The default behavior is to mount 
         any method caller interceptor chains (method execution chains are handled correctly by default).
         If you want to override the behaviour, the parameters are:
         </p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <code class="literal">invocation</code> - The invocation driving the chain of advices.</li>
               <li>
                  <code class="literal">method</code> - The method being invoked</li>
               <li>
                  <code class="literal">instance</code> - The instance on which we are invoking a non-static method.</li>
               <li>
                  <code class="literal">args</code> - Values for the method arguments.
            </li>
            </ul>
         </div>
         <p>
      
         </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="reflection.html">
               <strong>Prev</strong>Chapter 12. Reflection and AOP</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="reflection-cleaning.html">
               <strong>Next</strong>12.2. Clean results from reflection info methods</a>
         </li>
      </ul>
   </body>
</html>