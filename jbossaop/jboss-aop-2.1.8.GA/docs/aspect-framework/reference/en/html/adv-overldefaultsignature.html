<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>4.4.2. Default Signature</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - Aspect-Oriented Framework for Java"/>
      <link rel="up" href="adv-overloaded.html" title="4.4. Overloaded Advices"/>
      <link rel="prev" href="adv-overlannotparamlowest.html" title="4.4.1.5. Lowest Priority"/>
      <link rel="next" href="adv-overldiffsign.html" title="4.4.3. Mixing Different Signatures"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="adv-overlannotparamlowest.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="adv-overldiffsign.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect2" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="adv-overldefaultsignature"/>4.4.2. Default Signature</h3>
               </div>
            </div>
         </div>
         <p>
            For the default around advice signature (i.e., without annotated parameters), there is only one parameter
            to analyze, the invocation. So, the priority rules are very simple:
         </p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <p>presence of the invocation parameter</p>
               </li>
               <li>
                  <p>assignability degree of the invocation parameter.</p>
               </li>
            </ul>
         </div>
         <p>
            Lets revisit the example given in the beginning of this section, in augmented version:
         </p>
         <pre class="programlisting">class POJO
{
   public int field;
   public POJO(){}
   public someMethod(){}
}


public class OneAspect
{
   public Object trace(MethodInvocation invocation) throws Throwable {...} //1
   public Object trace(ConstructorInvocation invocation) throws Throwable {...} //2
   public Object trace(Invocation invocation) throws Throwable {...} //3
   public Object trace() throws Throwable {...} //4
}


&lt;aop&gt;
   &lt;aspect class="OneAspect"/&gt;
   &lt;bind pointcut="all(POJO)"&gt;
      &lt;advice aspect="OneAspect" name="trace"/&gt;
   &lt;/bind&gt;
&lt;/aop&gt;</pre>
         <p>
            The fourth advice above will never be called, considering the presence rule. It is the only
            one that lacks the <code class="literal">Invocation</code> parameter, and would be called only if all
            others were considered invalid in a scenario, which won’t happen in this example. By ruling
            out this advice with the presence rule, all other advices are equivalent: the invocation parameter
            is present in all of them. So, we need to move on to the assignability degree rule to select
            one of them. However, the assignability degree needs to be calculated accordingly to the joinpoint
            being intercepted. JBoss AOP needs to evaluate each joinpoint type to be intercepted to do the
            correct selection for each case.
         </p>
         <p>
            Consider the interception of the constructor of <code class="literal">POJO</code>. In that case, the first advice
            is considered invalid, becase a <code class="literal">MethodInvocation</code> is not assignable from the invocation
            type that JBoss AOP will provide, <code class="literal">ConstrucorInvocation</code>. We are now left with the second
            and third advices. The second one has assignability degree of 0 on the invocation type. The third one,
            assignability degree of 1 (it takes one step in the hierarchy to go fom <code class="literal">ConstructorInvocation</code>
            to <code class="literal">Invocation</code>). So, in this case, JBoss AOP will select the second advice, because it
            is the valid advice with the lower assignability degree on the invocation.
         </p>
         <p>
            Similary, to intercept the execution of <code class="literal">POJO.someMethod()</code>, JBoss AOP will consider the second
            advice invalid, because it is supposed to receive an invocation whose type is assignable from
            <code class="literal">MethodInvocation</code>. Since the first advice has an assignability degree of 0 on the
            invocation, and the third one, assignability degree of 1, JBoss AOP will select the first one.
         </p>
         <p>
            Given that <code class="literal">Invocation</code> will always be the super class of the expected invocation type,
            JBoss AOP will select this advice, whose assignability degree will always be 1, only when the other two
            advices are invalid. That would be the case of a field read, where the invocation type is
            <code class="literal">FieldReadInvocation</code>.
         </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="adv-overlannotparamlowest.html">
               <strong>Prev</strong>4.4.1.5. Lowest Priority</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="adv-overldiffsign.html">
               <strong>Next</strong>4.4.3. Mixing Different Signatures</a>
         </li>
      </ul>
   </body>
</html>