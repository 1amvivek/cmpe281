<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>10.2.2.2. Improving Loadtime Performance</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="JBoss AOP - Aspect-Oriented Framework for Java"/>
      <link rel="up" href="ch10s02s02.html" title="10.2.2. Loadtime"/>
      <link rel="prev" href="ch10s02s02s01.html" title="10.2.2.1. Loadtime using JRockit"/>
      <link rel="next" href="ch10s02s03.html" title="10.2.3. HotSwap"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch10s02s02s01.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch10s02s03.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect3" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h4 class="title">
                     <a id="d0e4406"/>10.2.2.2. Improving Loadtime Performance</h4>
               </div>
            </div>
         </div>
         <p>
               JBoss AOP needs to do the same kinds of things that any standard Java
               profiling product needs to do.  It needs to be able to process bytecode at runtime before a class is loaded.
              JBoss AOP has to do a lot of work before a class can be loaded.  This means that boot time can end up being significantly slowed down.
               Once all classes are loaded though, load-time weaving has zero effect on the speed
               of your application.
            </p>
         <p>
                Besides boottime, load-time weaving has to create a lot of Javassist datastructures that represent the bytecode of a particular class.
               These datastructures consume a lot of memory.  JBoss AOP does its best to flush and garbage collect these datastructures, but some must
               be kept in memory.  This section focuses on how you can improve the performance of Loadtime weaving.
            </p>
         <div class="variablelist">
            <dl>
               <dt>
                  <span class="term">Increase the Java Heapspace</span>
               </dt>
               <dd>
                  <p>
                        In Java, when your application is getting close to eating up all of its memory/heapspace, the Java
                        Garbage Collector starts to run more frequently and aggressively.  When the GC starts running more often
                        the performance of your application will suffer.  JBoss AOP does its best to balance bootup speed vs.
                        memory consumption, but it does require loading bytecode into Javassist datastructures so it can analyze
                        and transform a class.  For speed purposes, the datastructures are cached thus leading to the extra memory consumption.
                        Javassist structures of non-transformed classes are placed a SoftReference cache, so they are GC'd when memory is running low.
                        Transformed classes, however, are locked in the cache.  Transformed classes are help in memory, as they may effect
                        pointcut matching on classes that haven't been loaded yet.
                     </p>
                  <p>
                        To increase your Heap size, use the standard <code class="literal">-Xmx</code> switch.
                     </p>
               </dd>
               <dt>
                  <span class="term">Filtering</span>
               </dt>
               <dd>
                  <p>
                     Filtering probably has the greatest effect on overall boot-time speed.
                     If you've ever worked with a Java profiling product before, you probably noticed that it has an option
                     to filter classes that you are not interested in profiling.  This can speed up performance of the tool.
                     JBoss AOP has to analyze every class in the system to make sure it does not need to be transformed.  THis
                      is one reason why load-time weaving can be so slow.  You can give JBoss AOP a lot of help by specifying
                      sets of classes that do not need to be transformed.
                  </p>
                  <p>
                     To enable filtering, you can use the <code class="literal">jboss.aop.exclude</code> System Property. This System Property
                     is a comma delimited list.  The strings in the list can be package names and/or classnames.  Packages/classes within
                     this list will ignored by JBoss AOP. You can use the wildcard <code class="literal">*</code> in place of a classname, this
                     will then exclude all classes. No other wildcards are supported.
                  </p>
                  <pre class="programlisting">
                     java -Djboss.aop.exclude=org.jboss,org.apache ...
                  </pre>
                  <p>
                     There is also a mirror opposite of exclude.  The System Property <code class="literal">jboss.aop.include</code> overrides any thing
                     specified with exclude.
                  </p>
               </dd>
               <dt>
                  <span class="term">Include ignored annotations</span>
               </dt>
               <dd>
                  <p>
                     To improve the startup time of JBoss AOP all invisible annotations (invisible annotations are all annotations that are not
                     annotated with <code class="literal">@Retention(RetentionPolicy.RUNTIME)</code>) are ignored by default.
                     To include them use the system property <code class="literal">jboss.aop.invisible.annotations</code> to add packages that will be
                     included, or add "*" to include all.
                  </p>
                  <pre class="programlisting">
                      java -Djboss.aop.include.annotations=com.foo.bar,org.my.company
                    </pre>
                  <p>
                    To include all:
                  </p>
                  <pre class="programlisting">
                      java -Djboss.aop.include.annotations=*
                    </pre>
               </dd>
               <dt>
                  <span class="term">Turn off optimizations</span>
               </dt>
               <dd>
                  <p>
                     To increase overall runtime performance, JBoss AOP has to dynamically create a lot of extra code.
                     If you turn off these optimizations, JBoss AOP can weave a bit quicker.  There is a good chance, depending on your application
                     that you will not even notice that these optimizations are turned off.  See <a href="insrumentation-modes.html" title="Chapter 14. Instrumentation Modes">Chapter 14, <i xmlns:xlink="http://www.w3.org/1999/xlink">Instrumentation Modes</i>
                     </a>
                     for how to switch between weaving modes.
                  </p>
               </dd>
               <dt>
                  <span class="term">Turn off pruning</span>
               </dt>
               <dd>
                  <p>
                     JBoss AOP tries to aggressive prune cached Javassist structures.  This may, may not have a tiny effect
                     on performance.  The <code class="literal">jboss.aop.prune</code>
                     system property can be set to turn off pruning.
                  </p>
                  <pre class="programlisting">
                     java -Djboss.aop.prune=false ...
                  </pre>
               </dd>
               <dt>
                  <span class="term">-client/-server</span>
               </dt>
               <dd>
                  <p>
                        Strangely enough, it seems that the -client VM switch is a little faster for JBoss AOP loadtime weaving
                        that -server.   If you are using the -server VM, trying switching to -client (the default).
                     </p>
               </dd>
               <dt>
                  <span class="term">Ignore</span>
               </dt>
               <dd>
                  <p>
                        A way to completely ignore classes from being instrumented. This overrides whatever you have set up using the include/exclude filters. The system property
                        is <code class="literal">jboss.aop.ignore</code>, and you can use wildcards in the classnames. As for include/exclude you may specify a comma separated list of class
                        name patterns. This following example avoids instrumenting the cglib generated proxies for hibernate:
                  	  </p>
                  <pre class="programlisting">
                        java -Djboss.aop.ignore=*$$EnhancerByCGLIB$$*
                  	</pre>
                  <p>
                     
                  </p>
               </dd>
            </dl>
         </div>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch10s02s02s01.html">
               <strong>Prev</strong>10.2.2.1. Loadtime using JRockit</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch10s02s03.html">
               <strong>Next</strong>10.2.3. HotSwap</a>
         </li>
      </ul>
   </body>
</html>